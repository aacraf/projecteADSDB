# -*- coding: utf-8 -*-
"""profiling_datasets.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1U01tCyeS2g1KTzaWDNH-ixL25fArBEld
"""

import duckdb
import os
from pandas_profiling import ProfileReport

def execute_profiling_datasets():

  dirname = os.path.dirname(__file__)

  # connect to trusted database
  con = duckdb.connect(database=os.path.join(dirname, '../storage/datasets.duckdb'), read_only=True)

  # obtain table names
  tables = con.execute("SHOW TABLES").fetchall()
  tables = list([t for (t,) in tables])

  #profile tables
  for ds in tables:
    df = con.execute(f'SELECT * FROM {ds}').df()
    profile = ProfileReport(df, title=ds, html={'style' : {'full_width':True}})
    profile.to_file(os.path.join(dirname, f'../profiling/{ds}.html'))

  #close connection
  con.close()